using System.ComponentModel;
using System.Reflection;

namespace GameBoy.Core;

public static class OpcodeCbExtensions
{
    private static readonly string[] s_descriptions = [.. typeof(OpcodeCb)
            .GetFields()
            .Where(x => x.IsLiteral)
            .OrderBy(x => (byte)x.GetRawConstantValue()!)
            .Select(x => x.GetCustomAttribute<DescriptionAttribute>()!.Description)];

    private static readonly Func<Cpu, byte>[] s_functionTable = [
        static (cpu) => cpu.RLC_B(),
        static (cpu) => cpu.RLC_C(),
        static (cpu) => cpu.RLC_D(),
        static (cpu) => cpu.RLC_E(),
        static (cpu) => cpu.RLC_H(),
        static (cpu) => cpu.RLC_L(),
        static (cpu) => cpu.RLC_ptr_HL(),
        static (cpu) => cpu.RLC_A(),
        static (cpu) => cpu.RRC_B(),
        static (cpu) => cpu.RRC_C(),
        static (cpu) => cpu.RRC_D(),
        static (cpu) => cpu.RRC_E(),
        static (cpu) => cpu.RRC_H(),
        static (cpu) => cpu.RRC_L(),
        static (cpu) => cpu.RRC_ptr_HL(),
        static (cpu) => cpu.RRC_A(),
        static (cpu) => cpu.RL_B(),
        static (cpu) => cpu.RL_C(),
        static (cpu) => cpu.RL_D(),
        static (cpu) => cpu.RL_E(),
        static (cpu) => cpu.RL_H(),
        static (cpu) => cpu.RL_L(),
        static (cpu) => cpu.RL_ptr_HL(),
        static (cpu) => cpu.RL_A(),
        static (cpu) => cpu.RR_B(),
        static (cpu) => cpu.RR_C(),
        static (cpu) => cpu.RR_D(),
        static (cpu) => cpu.RR_E(),
        static (cpu) => cpu.RR_H(),
        static (cpu) => cpu.RR_L(),
        static (cpu) => cpu.RR_ptr_HL(),
        static (cpu) => cpu.RR_A(),
        static (cpu) => cpu.SLA_B(),
        static (cpu) => cpu.SLA_C(),
        static (cpu) => cpu.SLA_D(),
        static (cpu) => cpu.SLA_E(),
        static (cpu) => cpu.SLA_H(),
        static (cpu) => cpu.SLA_L(),
        static (cpu) => cpu.SLA_ptr_HL(),
        static (cpu) => cpu.SLA_A(),
        static (cpu) => cpu.SRA_B(),
        static (cpu) => cpu.SRA_C(),
        static (cpu) => cpu.SRA_D(),
        static (cpu) => cpu.SRA_E(),
        static (cpu) => cpu.SRA_H(),
        static (cpu) => cpu.SRA_L(),
        static (cpu) => cpu.SRA_ptr_HL(),
        static (cpu) => cpu.SRA_A(),
        static (cpu) => cpu.SWAP_B(),
        static (cpu) => cpu.SWAP_C(),
        static (cpu) => cpu.SWAP_D(),
        static (cpu) => cpu.SWAP_E(),
        static (cpu) => cpu.SWAP_H(),
        static (cpu) => cpu.SWAP_L(),
        static (cpu) => cpu.SWAP_ptr_HL(),
        static (cpu) => cpu.SWAP_A(),
        static (cpu) => cpu.SRL_B(),
        static (cpu) => cpu.SRL_C(),
        static (cpu) => cpu.SRL_D(),
        static (cpu) => cpu.SRL_E(),
        static (cpu) => cpu.SRL_H(),
        static (cpu) => cpu.SRL_L(),
        static (cpu) => cpu.SRL_ptr_HL(),
        static (cpu) => cpu.SRL_A(),
        static (cpu) => cpu.BIT_0_B(),
        static (cpu) => cpu.BIT_0_C(),
        static (cpu) => cpu.BIT_0_D(),
        static (cpu) => cpu.BIT_0_E(),
        static (cpu) => cpu.BIT_0_H(),
        static (cpu) => cpu.BIT_0_L(),
        static (cpu) => cpu.BIT_0_ptr_HL(),
        static (cpu) => cpu.BIT_0_A(),
        static (cpu) => cpu.BIT_1_B(),
        static (cpu) => cpu.BIT_1_C(),
        static (cpu) => cpu.BIT_1_D(),
        static (cpu) => cpu.BIT_1_E(),
        static (cpu) => cpu.BIT_1_H(),
        static (cpu) => cpu.BIT_1_L(),
        static (cpu) => cpu.BIT_1_ptr_HL(),
        static (cpu) => cpu.BIT_1_A(),
        static (cpu) => cpu.BIT_2_B(),
        static (cpu) => cpu.BIT_2_C(),
        static (cpu) => cpu.BIT_2_D(),
        static (cpu) => cpu.BIT_2_E(),
        static (cpu) => cpu.BIT_2_H(),
        static (cpu) => cpu.BIT_2_L(),
        static (cpu) => cpu.BIT_2_ptr_HL(),
        static (cpu) => cpu.BIT_2_A(),
        static (cpu) => cpu.BIT_3_B(),
        static (cpu) => cpu.BIT_3_C(),
        static (cpu) => cpu.BIT_3_D(),
        static (cpu) => cpu.BIT_3_E(),
        static (cpu) => cpu.BIT_3_H(),
        static (cpu) => cpu.BIT_3_L(),
        static (cpu) => cpu.BIT_3_ptr_HL(),
        static (cpu) => cpu.BIT_3_A(),
        static (cpu) => cpu.BIT_4_B(),
        static (cpu) => cpu.BIT_4_C(),
        static (cpu) => cpu.BIT_4_D(),
        static (cpu) => cpu.BIT_4_E(),
        static (cpu) => cpu.BIT_4_H(),
        static (cpu) => cpu.BIT_4_L(),
        static (cpu) => cpu.BIT_4_ptr_HL(),
        static (cpu) => cpu.BIT_4_A(),
        static (cpu) => cpu.BIT_5_B(),
        static (cpu) => cpu.BIT_5_C(),
        static (cpu) => cpu.BIT_5_D(),
        static (cpu) => cpu.BIT_5_E(),
        static (cpu) => cpu.BIT_5_H(),
        static (cpu) => cpu.BIT_5_L(),
        static (cpu) => cpu.BIT_5_ptr_HL(),
        static (cpu) => cpu.BIT_5_A(),

        static (cpu) => cpu.BIT_6_B(),
        static (cpu) => cpu.BIT_6_C(),
        static (cpu) => cpu.BIT_6_D(),
        static (cpu) => cpu.BIT_6_E(),
        static (cpu) => cpu.BIT_6_H(),
        static (cpu) => cpu.BIT_6_L(),
        static (cpu) => cpu.BIT_6_ptr_HL(),
        static (cpu) => cpu.BIT_6_A(),
        static (cpu) => cpu.BIT_7_B(),
        static (cpu) => cpu.BIT_7_C(),
        static (cpu) => cpu.BIT_7_D(),
        static (cpu) => cpu.BIT_7_E(),
        static (cpu) => cpu.BIT_7_H(),
        static (cpu) => cpu.BIT_7_L(),
        static (cpu) => cpu.BIT_7_ptr_HL(),
        static (cpu) => cpu.BIT_7_A(),
        static (cpu) => cpu.RES_0_B(),
        static (cpu) => cpu.RES_0_C(),
        static (cpu) => cpu.RES_0_D(),
        static (cpu) => cpu.RES_0_E(),
        static (cpu) => cpu.RES_0_H(),
        static (cpu) => cpu.RES_0_L(),
        static (cpu) => cpu.RES_0_ptr_HL(),
        static (cpu) => cpu.RES_0_A(),
        static (cpu) => cpu.RES_1_B(),
        static (cpu) => cpu.RES_1_C(),
        static (cpu) => cpu.RES_1_D(),
        static (cpu) => cpu.RES_1_E(),
        static (cpu) => cpu.RES_1_H(),
        static (cpu) => cpu.RES_1_L(),
        static (cpu) => cpu.RES_1_ptr_HL(),
        static (cpu) => cpu.RES_1_A(),
        static (cpu) => cpu.RES_2_B(),
        static (cpu) => cpu.RES_2_C(),
        static (cpu) => cpu.RES_2_D(),
        static (cpu) => cpu.RES_2_E(),
        static (cpu) => cpu.RES_2_H(),
        static (cpu) => cpu.RES_2_L(),
        static (cpu) => cpu.RES_2_ptr_HL(),
        static (cpu) => cpu.RES_2_A(),
        static (cpu) => cpu.RES_3_B(),
        static (cpu) => cpu.RES_3_C(),
        static (cpu) => cpu.RES_3_D(),
        static (cpu) => cpu.RES_3_E(),
        static (cpu) => cpu.RES_3_H(),
        static (cpu) => cpu.RES_3_L(),
        static (cpu) => cpu.RES_3_ptr_HL(),
        static (cpu) => cpu.RES_3_A(),
        static (cpu) => cpu.RES_4_B(),
        static (cpu) => cpu.RES_4_C(),
        static (cpu) => cpu.RES_4_D(),
        static (cpu) => cpu.RES_4_E(),
        static (cpu) => cpu.RES_4_H(),
        static (cpu) => cpu.RES_4_L(),
        static (cpu) => cpu.RES_4_ptr_HL(),
        static (cpu) => cpu.RES_4_A(),
        static (cpu) => cpu.RES_5_B(),
        static (cpu) => cpu.RES_5_C(),
        static (cpu) => cpu.RES_5_D(),
        static (cpu) => cpu.RES_5_E(),
        static (cpu) => cpu.RES_5_H(),
        static (cpu) => cpu.RES_5_L(),
        static (cpu) => cpu.RES_5_ptr_HL(),
        static (cpu) => cpu.RES_5_A(),
        static (cpu) => cpu.RES_6_B(),
        static (cpu) => cpu.RES_6_C(),
        static (cpu) => cpu.RES_6_D(),
        static (cpu) => cpu.RES_6_E(),
        static (cpu) => cpu.RES_6_H(),
        static (cpu) => cpu.RES_6_L(),
        static (cpu) => cpu.RES_6_ptr_HL(),
        static (cpu) => cpu.RES_6_A(),
        static (cpu) => cpu.RES_7_B(),
        static (cpu) => cpu.RES_7_C(),
        static (cpu) => cpu.RES_7_D(),
        static (cpu) => cpu.RES_7_E(),
        static (cpu) => cpu.RES_7_H(),
        static (cpu) => cpu.RES_7_L(),
        static (cpu) => cpu.RES_7_ptr_HL(),
        static (cpu) => cpu.RES_7_A(),
        static (cpu) => cpu.SET_0_B(),
        static (cpu) => cpu.SET_0_C(),
        static (cpu) => cpu.SET_0_D(),
        static (cpu) => cpu.SET_0_E(),
        static (cpu) => cpu.SET_0_H(),
        static (cpu) => cpu.SET_0_L(),
        static (cpu) => cpu.SET_0_ptr_HL(),
        static (cpu) => cpu.SET_0_A(),
        static (cpu) => cpu.SET_1_B(),
        static (cpu) => cpu.SET_1_C(),
        static (cpu) => cpu.SET_1_D(),
        static (cpu) => cpu.SET_1_E(),
        static (cpu) => cpu.SET_1_H(),
        static (cpu) => cpu.SET_1_L(),
        static (cpu) => cpu.SET_1_ptr_HL(),
        static (cpu) => cpu.SET_1_A(),
        static (cpu) => cpu.SET_2_B(),
        static (cpu) => cpu.SET_2_C(),
        static (cpu) => cpu.SET_2_D(),
        static (cpu) => cpu.SET_2_E(),
        static (cpu) => cpu.SET_2_H(),
        static (cpu) => cpu.SET_2_L(),
        static (cpu) => cpu.SET_2_ptr_HL(),
        static (cpu) => cpu.SET_2_A(),
        static (cpu) => cpu.SET_3_B(),
        static (cpu) => cpu.SET_3_C(),
        static (cpu) => cpu.SET_3_D(),
        static (cpu) => cpu.SET_3_E(),
        static (cpu) => cpu.SET_3_H(),
        static (cpu) => cpu.SET_3_L(),
        static (cpu) => cpu.SET_3_ptr_HL(),
        static (cpu) => cpu.SET_3_A(),
        static (cpu) => cpu.SET_4_B(),
        static (cpu) => cpu.SET_4_C(),
        static (cpu) => cpu.SET_4_D(),
        static (cpu) => cpu.SET_4_E(),
        static (cpu) => cpu.SET_4_H(),
        static (cpu) => cpu.SET_4_L(),
        static (cpu) => cpu.SET_4_ptr_HL(),
        static (cpu) => cpu.SET_4_A(),
        static (cpu) => cpu.SET_5_B(),
        static (cpu) => cpu.SET_5_C(),
        static (cpu) => cpu.SET_5_D(),
        static (cpu) => cpu.SET_5_E(),
        static (cpu) => cpu.SET_5_H(),
        static (cpu) => cpu.SET_5_L(),
        static (cpu) => cpu.SET_5_ptr_HL(),
        static (cpu) => cpu.SET_5_A(),
        static (cpu) => cpu.SET_6_B(),
        static (cpu) => cpu.SET_6_C(),
        static (cpu) => cpu.SET_6_D(),
        static (cpu) => cpu.SET_6_E(),
        static (cpu) => cpu.SET_6_H(),
        static (cpu) => cpu.SET_6_L(),
        static (cpu) => cpu.SET_6_ptr_HL(),
        static (cpu) => cpu.SET_6_A(),
        static (cpu) => cpu.SET_7_B(),
        static (cpu) => cpu.SET_7_C(),
        static (cpu) => cpu.SET_7_D(),
        static (cpu) => cpu.SET_7_E(),
        static (cpu) => cpu.SET_7_H(),
        static (cpu) => cpu.SET_7_L(),
        static (cpu) => cpu.SET_7_ptr_HL(),
        static (cpu) => cpu.SET_7_A(),
    ];

    extension(OpcodeCb opcode)
    {
        public string Description => s_descriptions[(byte)opcode];
        public Func<Cpu, byte> Exec => s_functionTable[(byte)opcode];
    }
}
